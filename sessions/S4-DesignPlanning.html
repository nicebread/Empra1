<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="We plan the experimental design of our study and decide upon interventions">

<title>Forschungsorientiertes Praktikum I – Grundlagen der Forschung - Session 04 - Planning the experimental design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Forschungsorientiertes Praktikum I – Grundlagen der Forschung</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../sessions/sessions_overview.html"> 
<span class="menu-text">Sessions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides/slides_overview.html"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nicebread/Empra1"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#design-considerations" id="toc-design-considerations" class="nav-link" data-scroll-target="#design-considerations">Design considerations</a>
  <ul class="collapse">
  <li><a href="#experimental-conditions-and-their-order" id="toc-experimental-conditions-and-their-order" class="nav-link" data-scroll-target="#experimental-conditions-and-their-order">Experimental conditions and their order</a></li>
  <li><a href="#measured-variables-and-their-timing" id="toc-measured-variables-and-their-timing" class="nav-link" data-scroll-target="#measured-variables-and-their-timing">Measured variables and their timing</a></li>
  <li><a href="#pre--and-post-questionnaire-before-and-after-the-esm-period" id="toc-pre--and-post-questionnaire-before-and-after-the-esm-period" class="nav-link" data-scroll-target="#pre--and-post-questionnaire-before-and-after-the-esm-period">Pre- and Post-Questionnaire (before and after the ESM period)</a></li>
  </ul></li>
  <li><a href="#homework-1-read-zygar-et-al.-2022" id="toc-homework-1-read-zygar-et-al.-2022" class="nav-link" data-scroll-target="#homework-1-read-zygar-et-al.-2022">Homework 1: Read Zygar et al.&nbsp;(2022)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Session 04 - Planning the experimental design</h1>
</div>

<div>
  <div class="description">
    We plan the experimental design of our study and decide upon interventions
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<table class="table-striped table">
<colgroup>
<col style="width: 52%">
<col style="width: 12%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Topic</th>
<th style="text-align: center;">Duration</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Wrap-up Homework 1</td>
<td style="text-align: center;">30</td>
<td>Ch. Experimentology</td>
</tr>
<tr class="even">
<td style="text-align: left;">Planning the design</td>
<td style="text-align: center;">120</td>
<td>with 25 min group task</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wrap-up Homework 2</td>
<td style="text-align: center;">45</td>
<td>Intervention</td>
</tr>
<tr class="even">
<td style="text-align: left;">Homework: Read Zygar et al (2022)</td>
<td style="text-align: center;">5</td>
<td></td>
</tr>
</tbody>
</table>
<section id="design-considerations" class="level2">
<h2 class="anchored" data-anchor-id="design-considerations">Design considerations</h2>
<p>See <a href="https://docs.google.com/document/d/1bfd7jOaLDatERS8lGLlo7QRLCdl2gG35DcnmGgmIp80/edit?usp=sharing">Google sheet</a> for an updated version.</p>
<ol type="1">
<li>Show the different questions and decisions that need to be taken (50 min)</li>
<li>Four groups work on a subset of questions (25 min)</li>
<li>The group present their results to the plenum (30 min)</li>
</ol>
<section id="experimental-conditions-and-their-order" class="level3">
<h3 class="anchored" data-anchor-id="experimental-conditions-and-their-order">Experimental conditions and their order</h3>
<ul>
<li>Three experimental conditions: increase motivation, decrease motivation, neutral control
<ul>
<li>One generic control condition, or tailored control conditions for each intervention?</li>
</ul></li>
<li>How many days does the study go? (e.g., 7-8 days)</li>
<li>How to spread conditions across days?
<ul>
<li>Repeat exactly the same intervention?</li>
<li>Repeat the same condition, but different interventions? (i.e., participants are always pushed up <em>or</em> pushed down and have a control group)</li>
<li>Use the same type of intervention with different conditions (keep videos as category, but do one increase, one decrease, one neutral)</li>
</ul></li>
<li>How to balance/randomize the conditions across the EMI days? Start with a baseline measurement?
<ul>
<li>Always flip pos/neg/neutral? Or can we have 2 pos days in sequence?</li>
<li>PCNCPCN (7 days)</li>
</ul></li>
<li>How many conditions can be tested? We expect ~100 participants (who completed the study to the end).
<ul>
<li>100 participants x 2xpos, 2xneg</li>
<li>50 participants x 4xpos, 4xneg –&gt; less statistical power, more qualitative data</li>
</ul></li>
</ul>
</section>
<section id="measured-variables-and-their-timing" class="level3">
<h3 class="anchored" data-anchor-id="measured-variables-and-their-timing">Measured variables and their timing</h3>
<ul>
<li>When do we measure the DV?
<ul>
<li>Directly after intervention? Demand effects?</li>
<li>Wait some minutes? At least close to the intervention</li>
<li>In Zygar et al 2022, no effect was present any more in the evening report.
<ul>
<li>Either the intervention is only short lived, or participants lived out and saturated their motivation in the afternoon, so that no extra motivation is left in the evening.</li>
<li>At least we don’t have to worry about carry-over effects to the next day.</li>
</ul></li>
</ul></li>
<li>When to ask the qualitative questions about the interventions?</li>
<li>How to deal with the weekend? (Participants spend more time with partner, are more happy, and probably more motivated)
<ul>
<li>Counter-balance conditions across weekend days</li>
<li>All participants start on same day, say, Monday?</li>
<li>If the conditions systematically flip (P-C-N-C-P-C-N), then automaticall two different conditions are realized at the weekend.</li>
</ul></li>
</ul>
</section>
<section id="pre--and-post-questionnaire-before-and-after-the-esm-period" class="level3">
<h3 class="anchored" data-anchor-id="pre--and-post-questionnaire-before-and-after-the-esm-period">Pre- and Post-Questionnaire (before and after the ESM period)</h3>
<ul>
<li>What to put into the preliminary questionnaire?</li>
<li>What are inclusion criteria for the sample?
<ul>
<li>Interventions are done individually (not dyadic)</li>
<li>Must be in stable relationship (how long? Only hetero or everything?)</li>
</ul></li>
<li>Control variables?
<ul>
<li>daily level / state: Daily fluctuations of …?</li>
<li>person level / trait: Personality etc.</li>
</ul></li>
</ul>
</section>
</section>
<section id="homework-1-read-zygar-et-al.-2022" class="level2">
<h2 class="anchored" data-anchor-id="homework-1-read-zygar-et-al.-2022">Homework 1: Read Zygar et al.&nbsp;(2022)</h2>
<p>In this study we did a comparable EMI design:</p>
<blockquote class="blockquote">
<p>Zygar-Hoffmann, C., Cristoforo, L., Wolf, L., &amp; Schönbrodt, F. D. (2022). Eliciting short-term closeness in couple relationships with Ecological Momentary Interventions. <em>Collabra: Psychology, 8(1)</em>, 38599. <a href="https://doi.org/10.1525/collabra.38599">https://doi.org/10.1525/collabra.38599</a></p>
</blockquote>
<p>You can answer the following questions in English or in German. Please write the answers directly into the answer field in Moodle. (You can of course write the answers beforehand in Word or something, and then copy the answers in here). You do not need to read any of the cited references additionally, just refer to the paper.</p>
<ul>
<li>Q1: What are Ecological Momentary Interventions (EMIs)?</li>
<li>Q2: Give a one-sentence description of each of the four closeness interventions.</li>
<li>Q3: What were the main findings regarding the effectiveness of the closeness interventions compared to neutral control conditions?</li>
<li>Q4: How long did the intervention last? Did they find effects that lasted until the evening?</li>
<li>Q5a: How did they measure “State Relationship Closeness”?</li>
<li>Q5b: Would this be a suitable measure for the dependent variable in our own study (i.e., intimacy motivation)?</li>
</ul>
<!-- 

ANSWERS:

Q1: Interventions, that a) are compact, easy to understand and implement, should not require special resources or additional guidance and b) aim at a short-term impact 

Q2: 
1. Physical affection intervention: The participant is instructed to show physical affection, which goes beyond the casual physical affection in their everyday life, which is easily instructed and implemented and also can be tailored to the individual‘s unique relationship behavior.

2. Memory sharing intervention: The participants are instructed to bidrectionally share an favored yet untold childhood memory with their partner, since memory sharing is a specific type of self-disclosure, which has a positive effect on experienced suitable for close realtionships.

3. Eye contact intervention: The participants where instructed to silently share focused eye contact with their partners for five minutes, which should lead to feelings of acknowledgment and  closeness.

4. Life achievement intervention: The participants are instructed to take twenty minutes and discuss achievements they mastered as a team, which is supposed to induce closeness  through examining each others strengths.


Q3: The self reported closeness was significantly more postive on days of the closeness condition compared to the control condition. However, the evidence for the effect varied in strength depending on which of the four interventions was chosen.


Q4: 
This information is slightly hidden. See Table 9 and Figure 2 of the [Supplemental Material](https://osf.io/9bv48): The effect on closeness vanished in the evening report: None of the descriptive difference between control condition and experimental condition was significant any more, and two of the four were even in the wrong direction.


Q5a: With an adapted version of the Inclusion of Other in the Self (IOS) Scale: two overlapping circles, their overlapping area describing the emotional closeness to the participant‘s partner, on a scale from 1 to 7. Question: "How emotionally close do you feel to your partner at the moment?"

Q5b: 

 -->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nicebread\.github\.io\/Empra1\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>